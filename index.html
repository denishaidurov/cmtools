<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CM Tools</title>
    <style>
        :root {
            /* --- –¢–ï–ú–ù–ê–Ø –¢–ï–ú–ê --- */
            --bg-body: #0f172a;       
            --bg-card: #1e293b;       
            --input-bg: #334155;      
            --text-main: #f1f5f9;     
            --text-muted: #94a3b8;    
            --border-color: #475569;
            
            /* –ì—Ä–∞–¥–∏–µ–Ω—Ç—ã –∏ —Ü–≤–µ—Ç–∞ */
            --brand-gradient: linear-gradient(135deg, #ec4899 0%, #eab308 100%); 
            --brand-gradient-hover: linear-gradient(135deg, #f06292 0%, #ffca28 100%); 
            --brand-glow: rgba(236, 72, 153, 0.4);
            --success-color: #10b981;
            --danger-color: #ef4444;
            --accent-bg: rgba(236, 72, 153, 0.05);

            /* –§–æ–Ω –¥–ª—è –∫–æ–¥–∞ */
            --code-bg-light: #1a2333;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 40px 20px;
            background-color: var(--bg-body);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .container {
            width: 100%;
            max-width: 900px; /* –®–∏—Ä–∏–Ω–∞ –¥–ª—è –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
            background: var(--bg-card);
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.05);
            padding: 40px;
            position: relative;
            overflow: hidden;
            
            /* –ê–ù–ò–ú–ê–¶–ò–Ø –ò–ó–ú–ï–ù–ï–ù–ò–Ø –®–ò–†–ò–ù–´ */
            transition: max-width 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        /* –ö–ª–∞—Å—Å –¥–ª—è —É–∑–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞ (Welcome) */
        .container.narrow {
            max-width: 600px;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--brand-gradient);
            border-radius: 24px 24px 0 0;
        }

        /* --- –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–¨ --- */
        .mode-switcher-container {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }

        .mode-switcher {
            background-color: var(--input-bg);
            padding: 5px;
            border-radius: 50px;
            display: flex;
            gap: 5px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }

        .mode-switcher input[type="radio"] { display: none; }

        .mode-switcher label {
            padding: 10px 35px;
            border-radius: 40px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-muted);
            transition: all 0.3s ease;
            margin-bottom: 0;
            user-select: none;
        }

        .mode-switcher input[type="radio"]:checked + label {
            background: var(--brand-gradient);
            color: white;
            box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3);
        }

        /* --- –°–ï–ö–¶–ò–ò --- */
        .section-content {
            display: none;
            animation: fadeInSection 0.4s ease;
        }
        .section-content.active { display: block; }
        @keyframes fadeInSection {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* === –ù–û–í–´–ô –°–¢–ò–õ–¨: FUSION PANEL (–ï–î–ò–ù–´–ô –ë–õ–û–ö) === */
        .calc-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; /* –î–≤–µ —Ä–∞–≤–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ */
            gap: 0; /* –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫ */
            
            /* –ï–¥–∏–Ω—ã–π –∫–æ–Ω—Ç—É—Ä */
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            position: relative; /* –î–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è */
        }

        /* –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å–Ω–∞—è –ª–∏–Ω–∏—è */
        .calc-grid::before {
            content: '';
            position: absolute;
            top: 20px;
            bottom: 20px;
            left: 50%;
            width: 1px;
            background: var(--border-color);
            transform: translateX(-50%);
            z-index: 1;
            opacity: 0.5;
        }

        /* –ò–∫–æ–Ω–∫–∞ —Å—Ç—Ä–µ–ª–æ—á–∫–∏ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
        .calc-grid::after {
            content: '‚Üí';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            
            width: 32px;
            height: 32px;
            background: var(--bg-card); /* –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏, —á—Ç–æ–±—ã –ø–µ—Ä–µ–∫—Ä—ã—Ç—å –ª–∏–Ω–∏—é */
            border: 1px solid var(--border-color);
            border-radius: 50%;
            
            display: flex;
            align-items: center;
            justify-content: center;
            
            color: #ec4899;
            font-weight: 800;
            font-size: 1.2rem;
            z-index: 2;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–æ–≤–∏–Ω–æ–∫ */
        .calc-card {
            padding: 30px; /* –ë–æ–ª—å—à–µ –≤–æ–∑–¥—É—Ö–∞ */
            border: none; /* –£–±–∏—Ä–∞–µ–º –≥—Ä–∞–Ω–∏—Ü—ã —É –ø–æ–ª–æ–≤–∏–Ω–æ–∫ */
            background: transparent;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö (–ø—Ä–µ–≤—Ä–∞—â–∞–µ–º –≤ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å—Ç–µ–∫) */
        @media (max-width: 768px) {
            .calc-grid {
                grid-template-columns: 1fr;
            }
            /* –õ–∏–Ω–∏—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π */
            .calc-grid::before {
                top: 50%;
                left: 20px;
                right: 20px;
                width: auto;
                height: 1px;
                transform: translateY(-50%);
            }
            /* –°—Ç—Ä–µ–ª–∫–∞ –≤–Ω–∏–∑ */
            .calc-grid::after {
                content: '‚Üì';
            }
        }

        .card-header {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 800;
            color: var(--text-muted);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0.8;
        }
        
        .calc-card.target .card-header { color: #ec4899; opacity: 1; }

        /* --- –ü–û–õ–Ø –í–í–û–î–ê --- */
        .input-group { margin-bottom: 18px; }
        .input-group:last-child { margin-bottom: 0; }

        label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-muted);
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input, select, textarea {
            width: 100%;
            background-color: var(--input-bg);
            border: 1px solid transparent;
            color: var(--text-main);
            padding: 14px 16px;
            border-radius: 12px;
            font-size: 0.95rem;
            box-sizing: border-box;
            font-family: inherit;
            transition: all 0.2s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            background-color: #1e293b;
            border-color: #ec4899;
            box-shadow: 0 0 0 3px var(--brand-glow);
        }

        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2394a3b8'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
            background-size: 16px;
            padding-right: 35px;
            cursor: pointer;
        }

        /* --- DASHBOARD (–ò—Ç–æ–≥–∏) --- */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 40px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: var(--input-bg);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.05);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .stat-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            margin-bottom: 8px;
            font-weight: 700;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--text-main);
        }

        .stat-value.burned { color: #ef4444; }
        .stat-value.residue { color: #10b981; }
        .stat-value.total { color: #ec4899; font-size: 1.6rem; }

        /* --- –ü–†–û–ì–†–ï–°–° –ë–ê–† --- */
        .progress-container { margin-bottom: 30px; }
        .progress-labels { display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-muted); margin-bottom: 8px; font-weight: 600; }
        .progress-track { height: 8px; background: #334155; border-radius: 4px; overflow: hidden; position: relative; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #ef4444 0%, #f59e0b 100%); width: 0%; transition: width 0.5s ease; }

        /* --- –ö–ù–û–ü–ö–ò --- */
        .actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 14px;
            color: white;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        button:hover { transform: translateY(-2px); box-shadow: 0 8px 20px -5px rgba(0,0,0,0.4); }
        button:active { transform: scale(0.98); }

        #generate-button { background: var(--brand-gradient); }
        #generate-button:hover { background: var(--brand-gradient-hover); }

        #copy-button, #calc-copy-button {
            background-color: #334155;
            border: 1px solid var(--success-color);
            color: var(--success-color);
        }
        #copy-button:hover, #calc-copy-button:hover {
            background-color: var(--success-color);
            color: white;
        }

        /* --- RESULT BOX --- */
        .result-box {
            margin-top: 40px;
            border-top: 1px solid var(--border-color);
            padding-top: 30px;
            display: none; 
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease; 
        }
        
        @keyframes resultEntry {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-box.is-visible {
            display: block; 
            animation: resultEntry 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; 
        }

        .result-box.calc-visible {
            display: block;
            opacity: 1;
            transform: none;
            margin-top: 20px;
            padding-top: 20px;
            border: none;
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: var(--text-main);
            font-size: 0.9rem;
            font-weight: 700;
        }

        textarea {
            font-family: 'Consolas', 'Monaco', monospace;
            background-color: var(--code-bg-light);
            color: #e2e8f0;
            border: 1px solid var(--border-color);
            line-height: 1.6;
            resize: vertical;
            min-height: 80px;
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            box-sizing: border-box;
        }

        .label-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
        .label-row label { margin-bottom: 0; }
        
        .sales-book-link {
            font-size: 0.7rem;
            color: #ec4899;
            text-decoration: none;
            border: 1px solid #ec4899;
            padding: 3px 10px;
            border-radius: 8px;
            font-weight: 700;
            text-transform: uppercase;
            transition: all 0.2s;
            background: rgba(236, 72, 153, 0.05);
        }
        .sales-book-link:hover { background: #ec4899; color: white; }

        @media (max-width: 600px) {
            .dashboard-stats { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container narrow"> 
    <div class="mode-switcher-container">
        <div class="mode-switcher">
            <input type="radio" id="mode-welcome" name="app-mode" value="welcome" checked>
            <label for="mode-welcome">Welcome</label>
            <input type="radio" id="mode-calculator" name="app-mode" value="calculator">
            <label for="mode-calculator">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</label>
        </div>
    </div>

    <div id="section-welcome" class="section-content active">
        <form id="welcome-form" class="grid-layout" style="display:grid; gap:20px;">
            <div class="input-group">
                <label>–í—ã–±–µ—Ä–∏—Ç–µ –∫—É—Ä—Å</label>
                <select id="course-select" required>
                    <option value="" disabled selected>–ù–µ –≤—ã–±—Ä–∞–Ω–æ</option>
                    <option value="Digital-–¥–∏–∑–∞–π–Ω–µ—Ä –Ω–æ–≤–æ–π —ç—Ä—ã 3.0">Digital-–¥–∏–∑–∞–π–Ω–µ—Ä –Ω–æ–≤–æ–π —ç—Ä—ã 3.0</option>
                    <option value="Digital-–¥–∏–∑–∞–π–Ω–µ—Ä 2.0">Digital-–¥–∏–∑–∞–π–Ω–µ—Ä 2.0</option>
                    <option value="NEW 3.0 –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –¥–∏–∑–∞–π–Ω">NEW 3.0 –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –¥–∏–∑–∞–π–Ω</option>
                    <option value="NEW –ü—Ä–æ—Ñ–µ—Å—Å–∏—è UX/UI-–¥–∏–∑–∞–π–Ω–µ—Ä">NEW –ü—Ä–æ—Ñ–µ—Å—Å–∏—è UX/UI-–¥–∏–∑–∞–π–Ω–µ—Ä</option>
                    <option value="–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –∏–ª–ª—é—Å—Ç—Ä–∞—Ç–æ—Ä 2.0">–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –∏–ª–ª—é—Å—Ç—Ä–∞—Ç–æ—Ä 2.0</option>
                    <option value="–í–µ–±-–¥–∏–∑–∞–π–Ω–µ—Ä 2.0">–í–µ–±-–¥–∏–∑–∞–π–Ω–µ—Ä 2.0</option>
                    <option value="–ù–µ–π—Ä–æ–¥–∏–∑–∞–π–Ω–µ—Ä 2.0">–ù–µ–π—Ä–æ–¥–∏–∑–∞–π–Ω–µ—Ä 2.0</option>
                    <option value="Motion-–¥–∏–∑–∞–π–Ω–µ—Ä">Motion-–¥–∏–∑–∞–π–Ω–µ—Ä</option>
                    <option value="NEW –î–∏–∑–∞–π–Ω –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤">NEW –î–∏–∑–∞–π–Ω –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤</option>
                    <option value="–î–∏–∑–∞–π–Ω —É–ø–∞–∫–æ–≤–∫–∏">–î–∏–∑–∞–π–Ω —É–ø–∞–∫–æ–≤–∫–∏</option>
                </select>
            </div>

            <div class="input-group fade-in" id="tariff-container" style="display:none;">
                <label>–¢–∞—Ä–∏—Ñ –æ–±—É—á–µ–Ω–∏—è</label>
                <select id="tariff-select"></select>
            </div>

            <div class="input-group">
                <label>–î–∞—Ç–∞ —Å—Ç–∞—Ä—Ç–∞</label>
                <input type="date" id="start-date" required>
            </div>

            <div class="actions">
                <button type="submit" id="generate-button">
                    <span>‚ö° –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</span>
                </button>
                <button type="button" id="copy-button" onclick="copyToClipboard('result-template', 'copy-button')" style="display:none;">
                    <span>üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>
                </button>
            </div>
        </form>

        <div class="result-box" id="result-box-welcome">
            <div class="result-header">
                <svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" color="#ec4899">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <strong>–ì–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç</strong>
            </div>
            <textarea id="result-template" readonly placeholder="// –ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è —Ç–µ–∫—Å—Ç..."></textarea>
        </div>
    </div>

    <div id="section-calculator" class="section-content">
        <form id="calculator-form">
            
            <div class="calc-grid">
                
                <div class="calc-card source">
                    <div class="card-header">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        –¢–µ–∫—É—â–µ–µ –æ–±—É—á–µ–Ω–∏–µ
                    </div>
                    
                    <div class="input-group">
                        <label>–ö—É—Ä—Å (–∏–∑ —Å–ø–∏—Å–∫–∞)</label>
                        <select id="calc-source-course">
                            <option value="" selected>–í–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é / –ù–µ –≤—ã–±—Ä–∞–Ω–æ</option>
                            <option value="Digital-–¥–∏–∑–∞–π–Ω–µ—Ä –Ω–æ–≤–æ–π —ç—Ä—ã 3.0">Digital-–¥–∏–∑–∞–π–Ω–µ—Ä –Ω–æ–≤–æ–π —ç—Ä—ã 3.0</option>
                            <option value="Digital-–¥–∏–∑–∞–π–Ω–µ—Ä 2.0">Digital-–¥–∏–∑–∞–π–Ω–µ—Ä 2.0</option>
                            <option value="NEW 3.0 –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –¥–∏–∑–∞–π–Ω">NEW 3.0 –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –¥–∏–∑–∞–π–Ω</option>
                            <option value="NEW –ü—Ä–æ—Ñ–µ—Å—Å–∏—è UX/UI-–¥–∏–∑–∞–π–Ω–µ—Ä">NEW –ü—Ä–æ—Ñ–µ—Å—Å–∏—è UX/UI-–¥–∏–∑–∞–π–Ω–µ—Ä</option>
                            <option value="–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –∏–ª–ª—é—Å—Ç—Ä–∞—Ç–æ—Ä 2.0">–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –∏–ª–ª—é—Å—Ç—Ä–∞—Ç–æ—Ä 2.0</option>
                            <option value="–í–µ–±-–¥–∏–∑–∞–π–Ω–µ—Ä 2.0">–í–µ–±-–¥–∏–∑–∞–π–Ω–µ—Ä 2.0</option>
                            <option value="–ù–µ–π—Ä–æ–¥–∏–∑–∞–π–Ω–µ—Ä 2.0">–ù–µ–π—Ä–æ–¥–∏–∑–∞–π–Ω–µ—Ä 2.0</option>
                            <option value="Motion-–¥–∏–∑–∞–π–Ω–µ—Ä">Motion-–¥–∏–∑–∞–π–Ω–µ—Ä</option>
                            <option value="NEW –î–∏–∑–∞–π–Ω –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤">NEW –î–∏–∑–∞–π–Ω –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤</option>
                            <option value="–î–∏–∑–∞–π–Ω —É–ø–∞–∫–æ–≤–∫–∏">–î–∏–∑–∞–π–Ω —É–ø–∞–∫–æ–≤–∫–∏</option>
                        </select>
                    </div>

                    <div class="input-group fade-in" id="calc-source-tariff-container" style="display:none;">
                        <label>–¢–∞—Ä–∏—Ñ</label>
                        <select id="calc-source-tariff"></select>
                    </div>

                    <div class="input-group">
                        <label>–û–ø–ª–∞—á–µ–Ω–æ (—Ä—É–±)</label>
                        <input type="number" id="calc-paid" placeholder="0" required>
                    </div>

                    <div class="input-group">
                        <label>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–µ—Å)</label>
                        <input type="number" id="calc-duration-months" value="12" required>
                    </div>

                    <div class="input-group">
                        <label>–î–∞—Ç–∞ —Å—Ç–∞—Ä—Ç–∞</label>
                        <input type="date" id="calc-start-date" required>
                    </div>
                    
                    <div class="input-group">
                        <label>–î–∞—Ç–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è</label>
                        <input type="date" id="calc-request-date" required>
                    </div>
                </div>

                <div class="calc-card target">
                    <div class="card-header">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg>
                        –ü–µ—Ä–µ–≤–æ–¥ –Ω–∞
                    </div>

                    <div class="input-group">
                        <label>–ù–æ–≤—ã–π –∫—É—Ä—Å</label>
                        <select id="calc-new-course-name" required>
                            <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ...</option>
                            <option value="manual">‚úçÔ∏è –í–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é</option>
                            <option value="Digital-–¥–∏–∑–∞–π–Ω–µ—Ä –Ω–æ–≤–æ–π —ç—Ä—ã 3.0">Digital-–¥–∏–∑–∞–π–Ω–µ—Ä –Ω–æ–≤–æ–π —ç—Ä—ã 3.0</option>
                            <option value="Digital-–¥–∏–∑–∞–π–Ω–µ—Ä 2.0">Digital-–¥–∏–∑–∞–π–Ω–µ—Ä 2.0</option>
                            <option value="NEW 3.0 –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –¥–∏–∑–∞–π–Ω">NEW 3.0 –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –¥–∏–∑–∞–π–Ω</option>
                            <option value="NEW –ü—Ä–æ—Ñ–µ—Å—Å–∏—è UX/UI-–¥–∏–∑–∞–π–Ω–µ—Ä">NEW –ü—Ä–æ—Ñ–µ—Å—Å–∏—è UX/UI-–¥–∏–∑–∞–π–Ω–µ—Ä</option>
                            <option value="–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –∏–ª–ª—é—Å—Ç—Ä–∞—Ç–æ—Ä 2.0">–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –∏–ª–ª—é—Å—Ç—Ä–∞—Ç–æ—Ä 2.0</option>
                            <option value="–í–µ–±-–¥–∏–∑–∞–π–Ω–µ—Ä 2.0">–í–µ–±-–¥–∏–∑–∞–π–Ω–µ—Ä 2.0</option>
                            <option value="–ù–µ–π—Ä–æ–¥–∏–∑–∞–π–Ω–µ—Ä 2.0">–ù–µ–π—Ä–æ–¥–∏–∑–∞–π–Ω–µ—Ä 2.0</option>
                            <option value="Motion-–¥–∏–∑–∞–π–Ω–µ—Ä">Motion-–¥–∏–∑–∞–π–Ω–µ—Ä</option>
                            <option value="NEW –î–∏–∑–∞–π–Ω –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤">NEW –î–∏–∑–∞–π–Ω –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤</option>
                            <option value="–î–∏–∑–∞–π–Ω —É–ø–∞–∫–æ–≤–∫–∏">–î–∏–∑–∞–π–Ω —É–ø–∞–∫–æ–≤–∫–∏</option>
                        </select>
                        <input type="text" id="calc-new-course-manual" class="fade-in" style="display:none; margin-top:10px;" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞">
                    </div>

                    <div class="input-group">
                        <div class="label-row">
                            <label>–°—Ç–æ–∏–º–æ—Å—Ç—å –Ω–æ–≤–æ–≥–æ (—Ä—É–±)</label>
                            <a href="https://docs.google.com/spreadsheets/d/1tGX-WJlBGYzmaci4Tb19goY_AQzbHnk3xZJ-pbXyLRs/edit?gid=1976664245#gid=1976664245" target="_blank" class="sales-book-link">üìñ –ö–Ω–∏–≥–∞ –ø—Ä–æ–¥–∞–∂</a>
                        </div>
                        <input type="number" id="calc-new-cost" placeholder="0" required>
                    </div>

                    <div class="input-group">
                        <label>–°–∫–∏–¥–∫–∞ (%)</label>
                        <input type="number" id="calc-discount" min="0" max="100" value="20">
                    </div>
                </div>
            </div>

            <div class="dashboard-stats">
                <div class="stat-box">
                    <div class="stat-label">–°–≥–æ—Ä–µ–ª–æ (–ø—Ä–æ–π–¥–µ–Ω–æ)</div>
                    <div class="stat-value burned" id="stat-consumed">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">–û—Å—Ç–∞—Ç–æ–∫ —Å—Ä–µ–¥—Å—Ç–≤</div>
                    <div class="stat-value residue" id="stat-residue">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">–ò—Ç–æ–≥–æ –∫ –¥–æ–ø–ª–∞—Ç–µ</div>
                    <div class="stat-value total" id="stat-topay">-</div>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-labels">
                    <span id="prog-days-studied">0 –¥–Ω–µ–π</span>
                    <span id="prog-days-total">–í—Å–µ–≥–æ 0 –¥–Ω–µ–π</span>
                </div>
                <div class="progress-track">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
            </div>

            <div class="result-box calc-visible" id="result-box-calc">
                <div class="result-header" style="color:var(--text-main); margin-bottom:10px;">
                    <strong>–¢–µ–∫—Å—Ç –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞</strong>
                </div>
                <textarea id="result-text-calc" readonly placeholder="–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–∞—Å—á–µ—Ç..."></textarea>
            </div>

            <div class="actions">
                <button type="button" id="calc-copy-button" onclick="copyToClipboard('result-text-calc', 'calc-copy-button')">
                    <span>üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç</span>
                </button>
            </div>
        </form>
    </div>

</div>

<script>
    // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
    const COURSE_CONFIG = {
        'Digital-–¥–∏–∑–∞–π–Ω–µ—Ä –Ω–æ–≤–æ–π —ç—Ä—ã 3.0': { templateType: 'Standard', streamTime: '19:00', defaultTariff: '–ë–∞–∑–æ–≤—ã–π', tariffs: { '–ë–∞–∑–æ–≤—ã–π': { months: 12, chat: 'https://t.me/+qn70Xd6J9aw4ZTVi', customAccess: '–Ω–∞ 18 –º–µ—Å—è—Ü–µ–≤' }, '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π': { months: 14, chat: 'https://t.me/+qn70Xd6J9aw4ZTVi', customAccess: '–Ω–∞–≤—Å–µ–≥–¥–∞' } }, anketa: 'https://docs.google.com/forms/d/e/1FAIpQLSfS9IitnBvCEi7HjgBYbhoCS2MijKA_y3slFu6fRnJJ7Y7DWA/viewform', curatorDZ: '–ú–∞—Ä–∏–Ω–∞ –ò–ª—å–µ–Ω–∫–æ', accessYears: 3 },
        '–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –∏–ª–ª—é—Å—Ç—Ä–∞—Ç–æ—Ä 2.0': { templateType: 'Standard', streamTime: '19:00', defaultTariff: '–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π', tariffs: { '–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π': { months: 9, chat: 'https://t.me/+KVHDByLijP8zYmJi' }, '–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π': { months: 13, chat: 'https://t.me/+KVHDByLijP8zYmJi' }, '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π': { months: 17, chat: 'https://t.me/+KVHDByLijP8zYmJi' } }, anketa: 'https://docs.google.com/forms/d/e/1FAIpQLSfS9IitnBvCEi7HjgBYbhoCS2MijKA_y3slFu6fRnJJ7Y7DWA/viewform', accessYears: 3, noStream: true },
        '–í–µ–±-–¥–∏–∑–∞–π–Ω–µ—Ä 2.0': { templateType: 'Standard', streamTime: '19:00', defaultTariff: '–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π', tariffs: { '–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π': { months: 12, chat: 'https://t.me/+PG30jTVyFUNiYjQy' }, '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π': { months: 14, chat: 'https://t.me/+PG30jTVyFUNiYjQy' } }, anketa: 'https://docs.google.com/forms/d/e/1FAIpQLSfS9IitnBvCEi7HjgBYbhoCS2MijKA_y3slFu6fRnJJ7Y7DWA/viewform', accessYears: 3, noStream: true },
        'Motion-–¥–∏–∑–∞–π–Ω–µ—Ä': { templateType: 'Standard', streamTime: '19:00', tariffs: null, chatLink: 'https://t.me/+LBfKLbM3B8Y2MWQy', months: 12, accessYears: 3, curatorDZ: '–ü–∞–≤–µ–ª –ü–µ–Ω–¥—é—Ä–∏–Ω', anketa: 'https://docs.google.com/forms/d/e/1FAIpQLSfS9IitnBvCEi7HjgBYbhoCS2MijKA_y3slFu6fRnJJ7Y7DWA/viewform', isMotion: true, noStream: true },
        'Digital-–¥–∏–∑–∞–π–Ω–µ—Ä 2.0': { templateType: 'Standard', streamTime: '19:00', defaultTariff: '–•–æ—á—É –≤—Å–µ –∏ —Å—Ä–∞–∑—É', tariffs: { '–•–æ—á—É –Ω–∞ —Ñ—Ä–∏–ª–∞–Ω—Å': { months: 6, chat: 'https://t.me/+qn70Xd6J9aw4ZTVi' }, '–•–æ—á—É —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ': { months: 9, chat: 'https://t.me/+qn70Xd6J9aw4ZTVi' }, '–•–æ—á—É –≤—Å–µ –∏ —Å—Ä–∞–∑—É': { months: 12, chat: 'https://t.me/+qn70Xd6J9aw4ZTVi' } }, anketa: 'https://docs.google.com/forms/d/e/1FAIpQLSfS9IitnBvCEi7HjgBYbhoCS2MijKA_y3slFu6fRnJJ7Y7DWA/viewform', curatorDZ: '–ú–∞—Ä–∏–Ω–∞ –ò–ª—å–µ–Ω–∫–æ', accessYears: 3 },
        'NEW 3.0 –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –¥–∏–∑–∞–π–Ω': { templateType: 'Standard', streamTime: '18:00', defaultTariff: '–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π', tariffs: { '1 —Å—Ç—É–ø–µ–Ω—å': { months: 4, chat: 'https://t.me/+algT3-99H18yOWEy', customAccess: '–Ω–∞ 6 –º–µ—Å—è—Ü–µ–≤' }, '–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π': { months: 7, chat: 'https://t.me/+algT3-99H18yOWEy' }, '–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π': { months: 12, chat: 'https://t.me/+algT3-99H18yOWEy' }, '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π': { months: 15, chat: 'https://t.me/+algT3-99H18yOWEy' } }, anketa: 'https://docs.google.com/forms/d/e/1FAIpQLSfS9IitnBvCEi7HjgBYbhoCS2MijKA_y3slFu6fRnJJ7Y7DWA/viewform', curatorDZ: '–ú–∞—Ä–∏–Ω–∞ –ò–ª—å–µ–Ω–∫–æ', accessYears: 3 },
        'NEW –ü—Ä–æ—Ñ–µ—Å—Å–∏—è UX/UI-–¥–∏–∑–∞–π–Ω–µ—Ä': { templateType: 'Standard', streamTime: '19:00', defaultTariff: '–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π', tariffs: { '–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π': { months: 13, chat: 'https://t.me/+PG30jTVyFUNiYjQy' }, '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π': { months: 16, chat: 'https://t.me/+PG30jTVyFUNiYjQy' } }, anketa: 'https://docs.google.com/forms/d/e/1FAIpQLSfS9IitnBvCEi7HjgBYbhoCS2MijKA_y3slFu6fRnJJ7Y7DWA/viewform', curatorDZ: '–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞ –ö–∞–º–µ–Ω—Å–∫–∞—è', accessYears: 3, noStream: true },
        '–ù–µ–π—Ä–æ–¥–∏–∑–∞–π–Ω–µ—Ä 2.0': { templateType: 'NeuroDesign', months: 3, accessYears: 1, chatLink: 'https://t.me/+RyvUSRyw_T9jMDZi', noStream: true },
        'NEW –î–∏–∑–∞–π–Ω –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤': { templateType: 'Marketplace', defaultTariff: '—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π', tariffs: { '—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π': { months: 2, accessYears: 1, chat: 'https://t.me/+2RfHq_VV1f0wMThi', curator: '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ì–æ–≥–ª–∞—á–µ–≤' }, '–±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏': { months: 2, accessYears: 1, chat: 'https://t.me/+2RfHq_VV1f0wMThi', curator: null } }, anketa: 'https://docs.google.com/forms/d/e/1FAIpQLSfS9IitnBvCEi7HjgBYbhoCS2MijKA_y3slFu6fRnJJ7Y7DWA/viewform', accessYears: 1 },
        '–î–∏–∑–∞–π–Ω —É–ø–∞–∫–æ–≤–∫–∏': { templateType: 'Packaging', months: 3, accessYears: 1, noStream: true }
    };

    // --- UI HELPERS ---
    const radios = document.getElementsByName('app-mode');
    const sections = { welcome: document.getElementById('section-welcome'), calculator: document.getElementById('section-calculator') };
    const container = document.querySelector('.container');
    
    radios.forEach(radio => radio.addEventListener('change', (e) => {
        const mode = e.target.value;
        Object.values(sections).forEach(el => el.classList.remove('active'));
        sections[mode].classList.add('active');
        
        if (mode === 'welcome') {
            container.classList.add('narrow');
        } else {
            container.classList.remove('narrow');
        }
    }));

    async function copyToClipboard(elementId, buttonId) {
        const el = document.getElementById(elementId);
        const btn = document.getElementById(buttonId);
        if (!el.value) return;
        try {
            await navigator.clipboard.writeText(el.value);
            const original = btn.innerHTML;
            btn.innerHTML = '<span>‚úÖ –ì–æ—Ç–æ–≤–æ!</span>';
            setTimeout(() => btn.innerHTML = original, 2000);
        } catch (e) { console.error(e); }
    }

    function autoResize(el) {
        el.style.height = 'auto';
        el.style.height = el.scrollHeight + 'px';
    }

    // --- REAL-TIME CALCULATOR LOGIC ---
    document.getElementById('calc-request-date').valueAsDate = new Date();

    const elsCalc = {
        inputs: document.querySelectorAll('#calculator-form input, #calculator-form select'),
        sourceCourse: document.getElementById('calc-source-course'),
        sourceTariffCont: document.getElementById('calc-source-tariff-container'),
        sourceTariff: document.getElementById('calc-source-tariff'),
        duration: document.getElementById('calc-duration-months'),
        newCourseSelect: document.getElementById('calc-new-course-name'),
        newCourseManual: document.getElementById('calc-new-course-manual'),
        // Output fields
        statConsumed: document.getElementById('stat-consumed'),
        statResidue: document.getElementById('stat-residue'),
        statToPay: document.getElementById('stat-topay'),
        progressFill: document.getElementById('progress-fill'),
        progDaysStudied: document.getElementById('prog-days-studied'),
        progDaysTotal: document.getElementById('prog-days-total'),
        resultText: document.getElementById('result-text-calc') 
    };

    elsCalc.sourceCourse.addEventListener('change', () => {
        const config = COURSE_CONFIG[elsCalc.sourceCourse.value];
        elsCalc.sourceTariff.innerHTML = '';
        if (config) {
            if (config.tariffs) {
                elsCalc.sourceTariffCont.style.display = 'block';
                Object.keys(config.tariffs).forEach((name, index) => {
                    const opt = document.createElement('option'); opt.value = name; opt.textContent = name; elsCalc.sourceTariff.appendChild(opt);
                    if (index === 0 && config.tariffs[name].months) elsCalc.duration.value = config.tariffs[name].months;
                });
            } else {
                elsCalc.sourceTariffCont.style.display = 'none';
                if (config.months) elsCalc.duration.value = config.months;
            }
        } else {
            elsCalc.sourceTariffCont.style.display = 'none';
            elsCalc.duration.value = '';
        }
        calculateLive();
    });

    elsCalc.sourceTariff.addEventListener('change', () => {
        const config = COURSE_CONFIG[elsCalc.sourceCourse.value];
        if (config && config.tariffs && config.tariffs[elsCalc.sourceTariff.value]) {
            const m = config.tariffs[elsCalc.sourceTariff.value].months;
            if (m) elsCalc.duration.value = m;
        }
        calculateLive();
    });

    elsCalc.newCourseSelect.addEventListener('change', () => {
        if (elsCalc.newCourseSelect.value === 'manual') {
            elsCalc.newCourseManual.style.display = 'block';
            elsCalc.newCourseManual.focus();
        } else {
            elsCalc.newCourseManual.style.display = 'none';
        }
        calculateLive();
    });

    function calculateLive() {
        const paid = parseFloat(document.getElementById('calc-paid').value) || 0;
        const durationMonths = parseFloat(document.getElementById('calc-duration-months').value) || 12;
        const startDateStr = document.getElementById('calc-start-date').value;
        const requestDateStr = document.getElementById('calc-request-date').value;
        const selectVal = document.getElementById('calc-new-course-name').value;
        const manualVal = document.getElementById('calc-new-course-manual').value;
        const newCourseName = (selectVal === 'manual') ? manualVal : selectVal;
        const newCost = parseFloat(document.getElementById('calc-new-cost').value) || 0;
        const discountPercent = parseFloat(document.getElementById('calc-discount').value) || 0;

        if (!startDateStr || !requestDateStr) {
            elsCalc.statConsumed.textContent = '-';
            elsCalc.statResidue.textContent = '-';
            elsCalc.statToPay.textContent = '-';
            return;
        }

        const start = new Date(startDateStr);
        const requestDate = new Date(requestDateStr);
        start.setHours(0,0,0,0);
        requestDate.setHours(0,0,0,0);

        let daysStudied = 0;
        if (start > requestDate) daysStudied = 0; 
        else daysStudied = Math.ceil(Math.abs(requestDate - start) / (1000 * 60 * 60 * 24));

        const AVG_DAYS_IN_MONTH = 30.44;
        const totalCourseDays = Math.round(durationMonths * AVG_DAYS_IN_MONTH);
        
        let pricePerDay = (totalCourseDays > 0) ? paid / totalCourseDays : 0;
        let consumedAmount = pricePerDay * daysStudied;
        if (consumedAmount > paid) consumedAmount = paid;

        const residualAmount = paid - consumedAmount;
        let toPayBase = newCost - residualAmount;
        if (toPayBase < 0) toPayBase = 0;

        const discountAmount = toPayBase * (discountPercent / 100);
        const oneTimePayment = Math.round(toPayBase - discountAmount);

        const fmt = (n) => Math.round(n).toLocaleString('ru-RU');
        elsCalc.statConsumed.textContent = fmt(consumedAmount) + ' ‚ÇΩ';
        elsCalc.statResidue.textContent = fmt(residualAmount) + ' ‚ÇΩ';
        elsCalc.statToPay.textContent = fmt(oneTimePayment) + ' ‚ÇΩ';

        const progressPct = totalCourseDays > 0 ? (daysStudied / totalCourseDays) * 100 : 0;
        const clampedPct = Math.min(Math.max(progressPct, 0), 100);
        elsCalc.progressFill.style.width = `${clampedPct}%`;
        elsCalc.progDaysStudied.textContent = `${daysStudied} –¥–Ω. –ø—Ä–æ–π–¥–µ–Ω–æ`;
        elsCalc.progDaysTotal.textContent = `–í—Å–µ–≥–æ ${totalCourseDays} –¥–Ω.`;

        const getInstallment = (m) => Math.round(toPayBase / m).toLocaleString('ru-RU');
        const text = `–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–∞ –∫—É—Ä—Å ${newCourseName || '...'} —Å–æ—Å—Ç–∞–≤–∏—Ç —Ä.${fmt(toPayBase)}
–í–æ–∑–º–æ–∂–Ω–∞ –±–µ—Å–ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Ä–∞—Å—Å—Ä–æ—á–∫–∞ –≤ –±–∞–Ω–∫–µ:¬†
–Ω–∞ 6 –º–µ—Å—è—Ü–µ–≤ ‚Äî ${getInstallment(6)} —Ä./–º–µ—Å.
–Ω–∞ 12 –º–µ—Å—è—Ü–µ–≤ ‚Äî ${getInstallment(12)} —Ä./–º–µ—Å.
–Ω–∞ 24 –º–µ—Å—è—Ü–∞ ‚Äî ${getInstallment(24)} —Ä./–º–µ—Å.
–Ω–∞ 36 –º–µ—Å—è—Ü–µ–≤ ‚Äî ${getInstallment(36)} —Ä./–º–µ—Å.

–ê –ø—Ä–∏ –µ–¥–∏–Ω–æ—Ä–∞–∑–æ–≤–æ–π –æ–ø–ª–∞—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å–∫–∏–¥–∫–∞ –æ—Ç –ö–æ–º–∞–Ω–¥—ã –∑–∞–±–æ—Ç—ã -${discountPercent}%üî•
–°—Ç–æ–∏–º–æ—Å—Ç—å –º–æ–∂–µ—Ç —Å–æ—Å—Ç–∞–≤–∏—Ç—å: ${fmt(oneTimePayment)} —Ä.`;

        elsCalc.resultText.value = text;
        autoResize(elsCalc.resultText);
    }

    elsCalc.inputs.forEach(input => {
        input.addEventListener('input', calculateLive);
        input.addEventListener('change', calculateLive);
    });

    // --- WELCOME LOGIC ---
    const elsWelcome = { 
        course: document.getElementById('course-select'), 
        tariffCont: document.getElementById('tariff-container'), 
        tariff: document.getElementById('tariff-select'), 
        date: document.getElementById('start-date'), 
        form: document.getElementById('welcome-form'),
        resultBox: document.getElementById('result-box-welcome'),
        resultText: document.getElementById('result-template'),
        copyBtn: document.getElementById('copy-button')
    };

    elsWelcome.course.addEventListener('change', () => {
        const c = COURSE_CONFIG[elsWelcome.course.value];
        elsWelcome.tariff.innerHTML = '';
        if (c && c.tariffs) {
            elsWelcome.tariffCont.style.display = 'block'; elsWelcome.tariff.setAttribute('required','');
            Object.keys(c.tariffs).forEach((n,i) => {
                const opt = document.createElement('option'); opt.value = n;
                opt.textContent = `¬´${n}¬ª` + (c.templateType !== 'Marketplace' ? ` (${c.tariffs[n].months} –º–µ—Å)` : '');
                if(i===0) elsWelcome.tariff.value=n;
                if(n===c.defaultTariff) opt.selected=true;
                elsWelcome.tariff.appendChild(opt);
            });
        } else { elsWelcome.tariffCont.style.display='none'; elsWelcome.tariff.removeAttribute('required'); }
    });

    const formatDateDDMMYYYY = (d) => { const dd = String(d.getDate()).padStart(2,'0'), mm = String(d.getMonth()+1).padStart(2,'0'), y = d.getFullYear(); return `${dd}.${mm}.${y}`; };
    const formatDateFull = (d) => d.toLocaleDateString('ru-RU', {day:'numeric', month:'long', year:'numeric'}).replace(/(\s–≥\.)?$/, ' –≥.');
    const formatDateStream = (d) => d.toLocaleDateString('ru-RU', {day:'numeric', month:'long'});
    const getMonthText = (n) => (n===1)?'–º–µ—Å—è—Ü':(n>=2&&n<=4)?'–º–µ—Å—è—Ü–∞':'–º–µ—Å—è—Ü–µ–≤';
    const getGreetingTime = () => { const h=new Date().getHours(); return (h>=5&&h<12)?"–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ":(h>=12&&h<18)?"–î–æ–±—Ä—ã–π –¥–µ–Ω—å":"–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä"; };

    elsWelcome.form.addEventListener('submit', (e) => {
        e.preventDefault();
        const courseTitle = elsWelcome.course.value;
        const tariffName = elsWelcome.tariff.value;
        const config = COURSE_CONFIG[courseTitle];
        if(!config) return;
        
        const rawDate = elsWelcome.date.value;
        const startDate = new Date(rawDate.replace(/-/g, '/'));
        const today = new Date(); today.setHours(0,0,0,0);
        const isPast = startDate < today;
        const dates = { full: formatDateFull(startDate), short: formatDateDDMMYYYY(startDate), stream: formatDateStream(startDate) };

        let bodyText = '';
        const startPhrase = isPast ? `–ú—ã –Ω–∞—á–∞–ª–∏ –æ–±—É—á–µ–Ω–∏–µ (${dates.full})` : `–ú—ã –Ω–∞—á–∏–Ω–∞–µ–º –æ–±—É—á–µ–Ω–∏–µ –≤–º–µ—Å—Ç–µ (${dates.full})`;
        
        if(config.templateType === 'Packaging') {
             bodyText = `üñá–£ –≤–∞—Å –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω –∫—É—Ä—Å ¬´${courseTitle}¬ª // –ü–æ—Ç–æ–∫ ${dates.short}, –ø–µ—Ä–∏–æ–¥ –æ–±—É—á–µ–Ω–∏—è ${config.months} –º–µ—Å—è—Ü–∞ —Å–æ –¥–Ω—è —Å—Ç–∞—Ä—Ç–∞ –ø–æ—Ç–æ–∫–∞, –¥–æ—Å—Ç—É–ø –∫ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º –∫—É—Ä—Å–∞ –Ω–∞ ${config.accessYears} –≥–æ–¥ —Å–æ –¥–Ω—è —Å—Ç–∞—Ä—Ç–∞ –ø–æ—Ç–æ–∫–∞\n\nüñá${startPhrase}, –∫—É—Ä—Å —Ä–∞–∑–º–µ—â–µ–Ω –Ω–∞ —É–¥–æ–±–Ω–æ–π –æ–±—É—á–∞—é—â–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ GetCourse. –ù–∞ –Ω–µ–π –≤—ã –Ω–∞–π–¥–µ—Ç–µ –≤–∏–¥–µ–æ—É—Ä–æ–∫–∏ –∏ –∑–∞–¥–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç –≤–∞–º –ø—Ä–æ–∫–∞—á–∞—Ç—å –Ω–∞–≤—ã–∫–∏.\n\n` + (isPast ? `üñá–ö—É—Ä—Å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–û–±—É—á–µ–Ω–∏–µ¬ª ‚Äî ¬´–¢—Ä–µ–Ω–∏–Ω–≥–∏¬ª` : `üñá–ö—É—Ä—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–û–±—É—á–µ–Ω–∏–µ¬ª ‚Äî ¬´–¢—Ä–µ–Ω–∏–Ω–≥–∏¬ª —Å ${dates.short}`) + `\n\nüñá–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–º–∞—à–Ω–∏—Ö —Ä–∞–±–æ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ. –ö—É—Ä–∞—Ç–æ—Ä –¥–∞—Å—Ç –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –ø–æ –≤–∞—à–µ–π —Ä–∞–±–æ—Ç–µ –≤ —Ç–µ—á–µ–Ω–∏–µ 3 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π. –û –ø—Ä–æ–≤–µ—Ä–∫–∞—Ö –∫—É—Ä–∞—Ç–æ—Ä–∞ –±—É–¥–µ—Ç —Å–æ–æ–±—â–∞—Ç—å –õ–æ–≥–æ–±–æ—Ç, –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—É—á–µ–Ω–∏—è.`;
        } else if (config.templateType === 'Marketplace') {
             const t = config.tariffs[tariffName];
             bodyText = `–£ –≤–∞—Å –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω –∫—É—Ä—Å ${courseTitle} ${tariffName} ‚Äî –ø–µ—Ä–∏–æ–¥ –æ–±—É—á–µ–Ω–∏—è ${t.months} ${getMonthText(t.months)}... (–¢–µ–∫—Å—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω)`;
        } else {
             let m = config.months; let cLink = config.chatLink;
             if(config.tariffs) { m = config.tariffs[tariffName].months; cLink = config.tariffs[tariffName].chat; }
             bodyText = `üñá–£ –≤–∞—Å –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω –∫—É—Ä—Å "${courseTitle} // ${tariffName || '–ü–æ—Ç–æ–∫'} ${dates.short}", –ø–µ—Ä–∏–æ–¥ –æ–±—É—á–µ–Ω–∏—è ${m} ${getMonthText(m)}... \n\n${startPhrase}, –∫—É—Ä—Å —Ä–∞–∑–º–µ—â–µ–Ω –Ω–∞ GetCourse. –°—Å—ã–ª–∫–∞ –Ω–∞ —á–∞—Ç: ${cLink}`;
        }

        const footer = config.templateType === 'Packaging' ? 
            `üñá–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –∫–∞–∫–∏–µ-–ª–∏–±–æ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –æ–±—É—á–µ–Ω–∏—é, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –ø–ª–∞–Ω–∞, –Ω—É–∂–Ω–∞ –º–æ—Ç–∏–≤–∞—Ü–∏—è, –≤—ã –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –Ω–∞–º ‚Äî –≤ –ö–æ–º–∞–Ω–¥—É –ó–∞–±–æ—Ç—ã. –ú—ã —Ä–∞–±–æ—Ç–∞–µ–º –∫–∞–∂–¥—ã–π –¥–µ–Ω—å —Å 10 –¥–æ 22 –ø–æ –ú–°–ö\n\n–° –Ω–µ—Ç–µ—Ä–ø–µ–Ω–∏–µ–º –∂–¥–µ–º –≤–∞—Å –Ω–∞ –æ–±—É—á–µ–Ω–∏–∏ üíï\nhttps://get.logomachine.ru/cms/system/login` :
            `üñá–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –∫–∞–∫–∏–µ-–ª–∏–±–æ –≤–æ–ø—Ä–æ—Å—ã... (–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ—É—Ç–µ—Ä) ... –° –Ω–µ—Ç–µ—Ä–ø–µ–Ω–∏–µ–º –∂–¥–µ–º –≤–∞—Å –Ω–∞ –æ–±—É—á–µ–Ω–∏–∏ üíï\nhttps://get.logomachine.ru/cms/system/login`;

        const fullText = `${getGreetingTime()}ü©∑ –ù–∞ —Å–≤—è–∑–∏ –ö–æ–º–∞–Ω–¥–∞ –∑–∞–±–æ—Ç—ã –æ—Ç —à–∫–æ–ª—ã –õ–æ–≥–æ–º–∞—à–∏–Ω–∞ —É—á–∏—Ç üíõ\n\n${bodyText}\n\n${footer}`;
        
        elsWelcome.resultText.value = fullText;
        elsWelcome.resultBox.classList.add('is-visible');
        elsWelcome.copyBtn.style.display = 'flex';
        autoResize(elsWelcome.resultText);
        elsWelcome.resultBox.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });

</script>
</body>
</html>
